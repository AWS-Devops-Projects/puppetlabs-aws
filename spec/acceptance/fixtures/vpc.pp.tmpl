ec2_vpc { '{{name}}-vpc':
  ensure           => {{ensure}},
  region           => 'sa-east-1',
  cidr_block       => '10.0.0.0/16',
  dhcp_options     => '{{name}}-options',
  instance_tenancy => 'default',
}

ec2_vpc_dhcp_options { '{{name}}-options':
  ensure            => {{ensure}},
  region            => 'sa-east-1',
  netbios_node_type => 2,
}

ec2_vpc_routetable { '{{name}}-routes':
  ensure => {{ensure}},
  region => 'sa-east-1',
  vpc    => '{{name}}-vpc',
  routes => [
    { destination_cidr_block => '10.0.0.0/16', gateway => 'local' },
  ],
}

ec2_vpc_subnet { '{{name}}-subnet':
  ensure            => {{ensure}},
  region            => 'sa-east-1',
  vpc               => '{{name}}-vpc',
  cidr_block        => '10.0.0.0/24',
  availability_zone => 'sa-east-1a',
  route_table       => '{{name}}-routes',
}

ec2_vpc_internet_gateway { '{{name}}-igw':
  ensure => {{ensure}},
  region => 'sa-east-1',
  vpcs   => '{{name}}-vpc',
}

ec2_vpc_customer_gateway { '{{name}}-cgw':
  ensure     => {{ensure}},
  region     => 'sa-east-1',
  ip_address => '173.255.197.131',
  bgp_asn    => 65000,
  type       => 'ipsec.1',
}

ec2_vpc_vpn { '{{name}}-vpn':
  ensure           => {{ensure}},
  region           => 'sa-east-1',
  vpn_gateway      => '{{name}}-vgw',
  customer_gateway => '{{name}}-cgw',
  type             => 'ipsec.1',
  routes           => ['0.0.0.0/0'],
  static_routes    => true,
}

ec2_vpc_vpn_gateway { '{{name}}-vgw':
  ensure => {{ensure}},
  region => 'sa-east-1',
  vpc    => '{{name}}-vpc',
  type   => 'ipsec.1',
}
